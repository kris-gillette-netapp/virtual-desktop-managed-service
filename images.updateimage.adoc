---
sidebar: sidebar
permalink: images.updateimages.html
summary: Updating and deploying VM images in VDMS
keywords:
---
= Update and Deploy VM Images
:toc: macro
:hardbreaks:
:toclevels: 2
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/
:keywords:

include::_include/Application.Delivery.Methodology.adoc[]

This article covers VM Image management. Directly installing applications on the SHVMs is covered in link:applications.installapplications.html[this article].

=== Updating the VM Image
The recommended method for adding (or removing) applications to SHVM(s) is by editing the  VM Image assigned to the host pool.  Once the VM Image is customized and validated, the VDMS support team can deploy it to all SHVMs in the host pool upon request.

.How to edit the VM image
. Navigate "Provisioning Collections" within the deployment in the VDS portal
. Click on the provisioning collection associated with the host pool you wish to update.
+
[.thumb]
image:applications.addtoapplibrary-fdcc3.png[900,900]

.. Make note of the "VM Template" name in the "Servers section.
+
[.thumb]
image:applications.deployapps-0e39c.png[900,900]
+
[.thumb]
image:applications.deployapps-c642c.png[900,900]

. Edit the Server template ensuring that the source template is the VM Template noted in step 2.a. above. Click "Continue"
+
[.thumb]
image:applications.deployapps-307cb.png[]

NOTE: *Don't edit these settings:*
1. Type = VDI
2. Share Drive = empty
3. Minimum Cache = 0
4. Data Drive = Unchecked
5. Storage Type = Standard_LRS

. The VDMS automation will now build a temporary VM in Azure, the machine name will be _CWT#_. Building this VM may take 25 minutes. Once the process completes the status will change to "Pending"
.. Note, this VM will run until the customization process is complete so it is important to build, customize and validate the VM within a day or two.
. Once the temporary VM is ready, you can log on to the VM by editing the Provisioning Collection and then clicking "Connect" on the server.
.. When prompted for credentials, domain admin credentials can be generated by any VDMS admin with "PAM Approver" rights.

.How to deploy an updated VM image
. Once the VM image is validated, contact the VDMS support team to schedule an image refresh.
. The team will build new session hosts based on the new image.
.. If required, please coordinate time to test the new hosts before we redirect new users to the new hosts.
. Once ready, the support team will redirect all new user sessions to the new hosts.  We'll shut down the old hosts once no users are connected. These old VMs will remain in a deallocated state for warm failover but these VMs will be automatically purged after 7 days.

=== Changing the SHVM(s) directly
Changes can be made directly on the SHVM(s) manually or via any available automation tools.

When making changes directly to the SHVMs in a host pool it is critical that each SHVM remain configured in the same way or users may have inconsistent experiences as they connect to different SHVMs.

WARNING: By default, individual SHVMs are not backed up because they typically don't have unique data and are based on a standardized VM image. If you're making customizations directly to the SHVMs, please contact support to get a backup policy applied to one of the SHVMs in the host pool.

=== SysPrep Troubleshooting
The VDMS image "Validate" function uses Microsoft's SysPrep utility.  When validation fails, the most common culprit is a SysPrep failure.  To troubleshoot failures, start in the SysPrep log file located on the CWT# VM in the path: C:\windows\system32\sysprep\panther\setupact.log
